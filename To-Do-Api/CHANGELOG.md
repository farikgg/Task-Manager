# Журнал изменений

Все значимые изменения в этом проекте будут документированы в этом файле.

## [1.1.0] - 2025-04-27

### Добавлено
- Реализация JWT Refresh Tokens
  - Новый эндпоинт `/api/auth/refresh` для обновления токенов
  - Новый эндпоинт `/api/auth/logout` для безопасного выхода
  - Поддержка HTTP-only cookies для refresh токенов
  - Ротация токенов для повышения безопасности
  - Поддержка нескольких refresh токенов на пользователя (макс. 5)
  - Автоматический механизм обновления токенов
  - Безопасная обработка cookies с поддержкой CORS credentials
- Внедрена валидация входных данных с помощью express-validator:
  - Проверка формата и длины username и password при регистрации и входе
  - Централизованная обработка ошибок валидации в контроллерах

### Изменено
- Обновлен процесс аутентификации для использования краткосрочных access токенов (15 минут)
- Улучшена безопасность с помощью ротации refresh токенов
- Изменена конфигурация CORS для поддержки credentials
- Обновлена модель User для хранения refresh токенов
- Улучшены сообщения об ошибках и ответы

### Безопасность
- Реализовано безопасное хранение refresh токенов в базе данных
- Добавлен контроль срока действия токенов
- Улучшена защита от кражи токенов
- Реализована безопасная обработка cookies
- Добавлена автоматическая ротация токенов

## [1.2.0] - 2025-05-04

### Добавлено
- Поддержка Docker для согласованной разработки и развертывания
- Конфигурация Docker Compose для локальной разработки
- Контейнеризация MongoDB-сервиса
- Управление томами для сохранения данных
- Конфигурации для разработки и production-окружения

### Изменено
- Обновлена структура проекта для поддержки контейнеризации
- Изменена обработка переменных окружения для Docker
- Улучшен рабочий процесс разработки с использованием контейнеризированных сервисов

### Технические детали
- Добавлен `Dockerfile`:
  - Базовый образ Node.js 20 Alpine
  - Многоэтапная сборка для оптимизации размера образа
  - Правильное управление зависимостями
  - Конфигурация для production

- Добавлен `docker-compose.yml`:
  - Конфигурация API-сервиса
  - Настройка MongoDB-сервиса
  - Управление томами для сохранения данных
  - Переменные окружения для разработки
  - Поддержка hot-reload для разработки

- Добавлен `.dockerignore`:
  - Исключены ненужные файлы из сборки
  - Оптимизирован контекст сборки
  - Улучшена безопасность путем исключения чувствительных файлов

### Настройка разработки
Для запуска проекта с Docker:

1. Собрать и запустить контейнеры:
   ```bash
   docker-compose up --build
   ```

2. Доступ к API: http://localhost:5001

3. MongoDB доступна по адресу mongodb://localhost:27017

### Развертывание в production
Для развертывания в production:

1. Собрать production-образ:
   ```bash
   docker build -t todo-api .
   ```

2. Запустить контейнер:
   ```bash
   docker run -p 5001:5001 <название контейнера>
   ```

### Примечания по безопасности
- Переменные окружения правильно управляются в Docker
- Чувствительные файлы исключены из сборки
- Конфигурации production отделены от разработки

## [1.3.1] - 2025-05-10
- Добавлен API для профиля пользователя (User Profile API):
  - Примеры: `GET /api/profile`, `PUT /api/profile`, `POST /api/profile/change-password`
- В модель User добавлено поле settings (User Settings):
  - Пример: `{ theme: 'light', language: 'ru', notifications: true }`
- Добавлена валидация (Validation) для обновления профиля и смены пароля:
  - Пример: username не менее 3 символов, новый пароль не менее 6 символов
- Подключены новые роуты пользователя (User Routes) в сервере:
  - Пример: `app.use('/api', userRoutes);`


## [1.4.0] - 2025-05-15
### Добавлено
- Интеграция Google OAuth для аутентификации:
  - Новые эндпоинты `/api/auth/google` и `/api/auth/google/callback`
  - Поддержка Passport.js для Google аутентификации
  - Автоматическая генерация JWT токенов после успешной Google аутентификации
  - Сохранение refresh токенов для Google-аутентифицированных пользователей

### Изменено
- Обновлена модель User для поддержки Google аутентификации:
  - Добавлены поля googleId и email
  - Расширена поддержка refresh токенов
- Улучшен процесс аутентификации для поддержки как локальной, так и Google аутентификации

### Безопасность
- Реализована безопасная обработка Google OAuth токенов
- Добавлена валидация Google профиля
- Улучшена защита от несанкционированного доступа

### Технические детали
- Добавлены новые зависимости:
  - passport
  - passport-google-oauth20
- Обновлены роуты аутентификации для поддержки Google OAuth
- Добавлена конфигурация Passport.js для Google стратегии

## [1.4.1] - 2025-05-24

### Добавлено
- Поддержка создания пользовательских категорий с выбором цвета.
- Категории теперь возвращаются как объекты с цветом, а не строки.
- Эндпоинты для работы с категориями поддерживают цвет и фильтрацию по пользователю.
- Улучшена логика получения задач: задачи фильтруются по userId, что позволяет корректно отображать задачи только текущего пользователя.

### Исправлено
- Исправлена обработка userId во всех контроллерах задач и категорий.
- Исправлены ошибки с CORS и поддержкой метода PATCH для обновления статуса задачи.
- Исправлена логика проверки дубликатов при создании категории.

## [Невыпущенное] - YYYY-MM-DD

### Исправления и улучшения

- Исправлена функция logout в auth контроллере: заменено использование `req.user.id` на `req.user.userId` для консистентности() с middleware авторизации.